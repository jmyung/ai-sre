[
  {
    "id": "kb-repl-001",
    "category": "replication",
    "title": "Redis 복제 지연(Replication Lag) 문제 해결",
    "symptoms": [
      "master_link_status가 down 상태",
      "master_repl_offset과 slave_repl_offset 차이 발생",
      "복제본에서 오래된 데이터 조회됨",
      "SLAVEOF/REPLICAOF 명령 후 동기화 지연"
    ],
    "root_causes": [
      "네트워크 대역폭 부족으로 복제 지연",
      "복제본의 처리 성능이 마스터를 따라가지 못함",
      "대용량 RDB 전송 중 타임아웃",
      "repl-backlog-size가 부족하여 부분 재동기화 실패",
      "마스터의 쓰기 부하가 과도함"
    ],
    "diagnosis_steps": [
      "INFO replication 명령으로 복제 상태 확인",
      "master_link_status, master_link_down_since_seconds 확인",
      "repl_backlog_size와 repl_backlog_histlen 비교",
      "복제본의 loading 상태 확인",
      "네트워크 대역폭 및 지연 측정",
      "복제본의 CPU, 메모리, 디스크 I/O 확인"
    ],
    "solutions": [
      "repl-backlog-size 값 증가로 부분 재동기화 범위 확대",
      "repl-timeout 값 증가",
      "네트워크 대역폭 확보 또는 복제본을 같은 네트워크로 이동",
      "복제본 서버 스펙 업그레이드",
      "diskless 복제 활성화 (repl-diskless-sync yes)",
      "필요시 복제본 재구성 (REPLICAOF NO ONE 후 재연결)"
    ],
    "prevention": [
      "repl-backlog-size를 충분히 크게 설정 (예: 512MB)",
      "복제 지연 모니터링 알림 설정",
      "복제본과 마스터 간 네트워크 품질 모니터링",
      "마스터 쓰기 부하 분산 (쓰기 샤딩)"
    ],
    "related_metrics": [
      "master_link_status",
      "master_repl_offset",
      "slave_repl_offset",
      "connected_slaves",
      "repl_backlog_size"
    ],
    "severity": "high",
    "tags": ["replication", "lag", "master", "slave", "replica", "sync"]
  },
  {
    "id": "kb-repl-002",
    "category": "replication",
    "title": "Redis 복제본 Full Resync 반복 문제",
    "symptoms": [
      "복제본이 계속 Full Resync 수행",
      "로그에 MASTER <-> REPLICA sync started 반복 출력",
      "복제본의 메모리와 CPU 사용량 급증",
      "마스터에서 RDB 생성 빈번"
    ],
    "root_causes": [
      "repl-backlog-size가 너무 작아 오프셋 유실",
      "복제본이 자주 재시작되거나 연결 끊김",
      "client-output-buffer-limit replica 초과",
      "마스터 RDB 생성 실패"
    ],
    "diagnosis_steps": [
      "마스터 로그에서 Partial resync not accepted 메시지 확인",
      "repl-backlog-size와 실제 트래픽 비교",
      "client-output-buffer-limit replica 설정 확인",
      "복제본의 연결 안정성 확인"
    ],
    "solutions": [
      "repl-backlog-size를 트래픽에 맞게 대폭 증가",
      "client-output-buffer-limit replica 값 조정",
      "네트워크 안정성 개선",
      "마스터 쓰기 트래픽 최적화"
    ],
    "prevention": [
      "repl-backlog-size를 넉넉하게 설정",
      "Full Resync 발생 모니터링",
      "복제본 안정성 점검"
    ],
    "related_metrics": [
      "sync_full",
      "sync_partial_ok",
      "sync_partial_err",
      "repl_backlog_size"
    ],
    "severity": "high",
    "tags": ["replication", "full resync", "partial sync", "backlog"]
  }
]
