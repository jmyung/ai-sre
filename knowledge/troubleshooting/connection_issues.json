[
  {
    "id": "kb-conn-001",
    "category": "connection",
    "title": "Redis Max Clients 초과 장애 대응",
    "symptoms": [
      "ERR max number of clients reached 에러 발생",
      "새로운 클라이언트 연결 거부됨",
      "rejected_connections 메트릭 증가",
      "애플리케이션에서 connection refused 에러"
    ],
    "root_causes": [
      "maxclients 설정값보다 많은 연결 시도",
      "클라이언트가 연결을 제대로 종료하지 않음 (connection leak)",
      "Slow query로 인한 연결 점유 시간 증가",
      "커넥션 풀 크기가 과도하게 설정됨",
      "서비스 장애로 인한 재연결 폭증"
    ],
    "diagnosis_steps": [
      "INFO clients 명령으로 현재 연결 수 확인",
      "CLIENT LIST 명령으로 연결된 클라이언트 목록 확인",
      "CLIENT LIST에서 idle 시간이 긴 연결 식별",
      "CONFIG GET maxclients로 최대 연결 수 확인",
      "netstat/ss 명령으로 TCP 연결 상태 확인"
    ],
    "solutions": [
      "maxclients 값 증가 (CONFIG SET maxclients <num>)",
      "idle 상태의 오래된 연결 종료 (CLIENT KILL)",
      "timeout 설정으로 idle 연결 자동 종료 (CONFIG SET timeout <seconds>)",
      "tcp-keepalive 설정으로 죽은 연결 감지",
      "애플리케이션 커넥션 풀 설정 점검",
      "Slow query 원인 파악 및 해결"
    ],
    "prevention": [
      "적절한 maxclients 값 설정 (OS ulimit과 함께 고려)",
      "timeout 값을 0이 아닌 적절한 값으로 설정",
      "애플리케이션에서 적절한 커넥션 풀 크기 설정",
      "connected_clients 모니터링 알림 설정",
      "tcp-keepalive 활성화 (기본 300초)"
    ],
    "related_metrics": [
      "connected_clients",
      "maxclients",
      "rejected_connections",
      "blocked_clients"
    ],
    "severity": "high",
    "tags": ["connection", "maxclients", "connection pool", "timeout"]
  },
  {
    "id": "kb-conn-002",
    "category": "connection",
    "title": "Redis 연결 타임아웃 문제 해결",
    "symptoms": [
      "클라이언트에서 connection timeout 에러 발생",
      "read timeout 또는 socket timeout 에러",
      "간헐적인 연결 실패",
      "latency가 급격히 증가"
    ],
    "root_causes": [
      "네트워크 지연 또는 패킷 손실",
      "Redis 서버의 높은 CPU 사용률",
      "Slow query로 인한 다른 요청 블로킹",
      "대용량 키 연산 (KEYS, SMEMBERS 등)",
      "RDB/AOF 저장 중 fork로 인한 지연",
      "메모리 스왑 발생"
    ],
    "diagnosis_steps": [
      "SLOWLOG GET 명령으로 느린 쿼리 확인",
      "INFO stats에서 instantaneous_ops_per_sec 확인",
      "INFO persistence에서 rdb_last_bgsave_status 확인",
      "INFO cpu에서 CPU 사용률 확인",
      "dmesg 또는 /var/log/messages에서 OOM killer 확인",
      "latency 명령으로 지연 측정 (LATENCY DOCTOR)"
    ],
    "solutions": [
      "Slow query 최적화 (KEYS 대신 SCAN 사용)",
      "대용량 키 연산 분할 처리",
      "클라이언트 타임아웃 값 적절히 조정",
      "스왑 비활성화 또는 메모리 증설",
      "bgsave 스케줄 조정",
      "replica에서 읽기 부하 분산"
    ],
    "prevention": [
      "slowlog-log-slower-than 설정으로 느린 쿼리 기록",
      "정기적인 SLOWLOG 모니터링",
      "위험한 명령어 rename (KEYS, FLUSHALL 등)",
      "vm.overcommit_memory=1 설정",
      "THP(Transparent Huge Pages) 비활성화"
    ],
    "related_metrics": [
      "instantaneous_ops_per_sec",
      "total_commands_processed",
      "latency_percentiles_usec_p99"
    ],
    "severity": "high",
    "tags": ["connection", "timeout", "latency", "slowlog"]
  }
]
